const fs = require('fs');
const path = require('path');

console.log('ğŸ”§ ê¸°ì¡´ ë°ì´í„°ë² ì´ìŠ¤ ê°œì„  ì‘ì—… ì‹œì‘...');

// ê¸°ì¡´ ë°ì´í„°ë² ì´ìŠ¤ ë¡œë“œ
const dbPath = path.join(__dirname, 'tww-s3-refined-database.json');
const database = JSON.parse(fs.readFileSync(dbPath, 'utf8'));

// í´ë˜ìŠ¤ë³„ ê¸°ë³¸ ìŠ¤í‚¬ ID ë§¤í•‘ (í™•ì‹¤í•œ ê¸°ë³¸ ìŠ¤í‚¬ë“¤)
const baselineSkills = {
  'WARRIOR': [
    '100', // ëŒì§„
    '355', // ë„ë°œ
    '6673', // ì „íˆ¬ì˜ ì™¸ì¹¨
    '18499', // ê´‘ì „ì‚¬ì˜ ê²©ë…¸
    '23920', // ì£¼ë¬¸ ë°˜ì‚¬
    '1160', // ì‚¬ê¸°ì˜ ì™¸ì¹¨
    '6544', // ì˜ì›…ì˜ ë„ì•½
    '5246', // ìœ„í˜‘ì˜ ì™¸ì¹¨
    '2565', // ë°©íŒ¨ ë§‰ê¸°
    '1715', // ë¬´ë ¥í™”
  ],
  'PALADIN': [
    '853', // ì‹¬íŒì˜ ë§ì¹˜
    '62124', // ì‹ ì˜ ê¶ŒëŠ¥
    '633', // ì‹ ì˜ ì¶•ë³µ
    '642', // ì²œìƒì˜ ë³´í˜¸ë§‰
    '1044', // ììœ ì˜ ì¶•ë³µ
    '1022', // ë³´í˜¸ì˜ ì¶•ë³µ
    '6940', // í¬ìƒì˜ ì¶•ë³µ
    '31884', // ì‘ì§•ì˜ ê²©ë…¸
    '184662', // ì‘ì§•ì˜ ë°©íŒ¨
    '85673', // ì˜ê´‘ì˜ ì„œì•½
  ],
  'HUNTER': [
    '1543', // ì„¬ê´‘íƒ„
    '19801', // í‰ì • ì‚¬ê²©
    '147362', // ì—­ìŠµ
    '186265', // ê±°ë¶ì˜ ìƒ
    '109304', // í™œì„±í™”
    '195645', // ë‚ ê°œ ì ˆë‹¨
    '1513', // ì•¼ìˆ˜ ìœ„í˜‘
    '5116', // ë‡Œì§„íƒ• ì‚¬ê²©
    '2643', // ë…ì‚¬ ì˜ê¸°
    '187650', // ë¹™ê²°ì˜ ë«
  ],
  'ROGUE': [
    '1784', // ì€ì‹ 
    '1766', // ë°œì°¨ê¸°
    '2094', // ì‹¤ëª…
    '1856', // ì†Œë©¸
    '5277', // íšŒí”¼
    '31224', // ê·¸ë¦¼ì ë§í† 
    '114018', // ì€ì‹ ì²˜
    '1725', // í˜¼ë€
    '2823', // ë…ì¹¼
    '3408', // ìƒì²˜ ê°ì—¼ ë…
  ],
  'PRIEST': [
    '17', // ì‹ ì˜ ê¶ŒëŠ¥: ë³´í˜¸ë§‰
    '21562', // ì‹ ì˜ ê¶ŒëŠ¥: ì¸ë‚´
    '2061', // ë¹›ì˜ ì„¬ê´‘
    '589', // ì•”í‘ì˜ ë§ˆë²•
    '8092', // ì •ì‹  í­ë°œ
    '605', // ì •ì‹  ì œì–´
    '586', // ì†Œì‹¤
    '528', // ì‚¬ì•… ë¬´íš¨í™”
    '527', // ì •í™”
    '2006', // ë¶€í™œ
  ],
  'SHAMAN': [
    '188196', // ë²ˆê°œ í™”ì‚´
    '51505', // ìš©ì•” í­ë°œ
    '188389', // í™”ì—¼ ì¶©ê²©
    '51490', // ì²œë‘¥í­í’
    '108271', // ì˜í˜¼ ì´ë™
    '556', // ì˜í˜¼ ê·€í™˜
    '2008', // ì„ ì¡°ì˜ ì˜í˜¼
    '370', // ëŒ€ì§€ ì •ë ¹ í† í…œ
    '51485', // ì†ë°•ì˜ í† í…œ
    '192058', // ë²ˆê°œ ì¶•ì „ê¸° í† í…œ
  ],
  'MAGE': [
    '1449', // ë¹„ì „ í­ë°œ
    '319836', // í™”ì—¼ í­ë°œ
    '116', // ì„œë¦¬ í™”ì‚´
    '2136', // í™”ì—¼ ì‘ë ¬
    '122', // ì–¼ìŒ íšŒì˜¤ë¦¬
    '130', // ì €ì† ë‚™í•˜
    '1953', // ì ë©¸
    '475', // íˆ¬ëª…í™”
    '80353', // ì‹œê°„ ì™œê³¡
    '190336', // ë¹„ì „ ì§€ëŠ¥
  ],
  'WARLOCK': [
    '172', // ë¶€íŒ¨
    '980', // ê³ í†µ
    '702', // ì–´ë‘ ì˜ ì €ì£¼
    '1454', // ìƒëª…ë ¥ ì§‘ì¤‘
    '5782', // ê³µí¬
    '710', // ì¶”ë°©
    '20707', // ì˜í˜¼ì„
    '698', // ì˜ì‹: ì†Œí™˜
    '697', // ì˜ì‹: ì†Œí™˜ì§„
    '48018', // ì•…ë§ˆì˜ ë§ˆë²•ì§„
  ],
  'MONK': [
    '100780', // í•´ì˜¤ë¦„ì°¨ê¸°
    '100784', // í‘ìš° ì°¨ê¸°
    '101546', // íšŒì „ í•™ë‹¤ë¦¬ì°¨ê¸°
    '109132', // êµ¬ë¥´ê¸°
    '115178', // ì¬í™œ
    '115203', // ê°•í™” ì£¼
    '115546', // ì†Œí˜¹ì˜ ì•ˆê°œ
    '116670', // í‰ì˜¨
    '116705', // ì†ë‚  ì°Œë¥´ê¸°
    '119381', // íŒ½ì´ì°¨ê¸°
  ],
  'DRUID': [
    '5487', // ê³° ë³€ì‹ 
    '768', // í‘œë²” ë³€ì‹ 
    '783', // ì—¬í–‰ ë³€ì‹ 
    '22812', // ë‚˜ë¬´ê»ì§ˆ
    '5211', // ê±°ì„¼ ê°•íƒ€
    '99', // ë°©í–¥ ê°ê° ìƒì‹¤ì˜ í¬íš¨
    '1126', // ì•¼ìƒì˜ ì§•í‘œ
    '20484', // í™˜ìƒ
    '29166', // ì •ì‹  ìê·¹
    '2908', // ë‹¬ë¹›ì„¬ê´‘
  ],
  'DEMONHUNTER': [
    '162794', // í˜¼ëˆì˜ ì¼ê²©
    '162243', // ì•…ë§ˆì˜ ì´ë¹¨
    '198013', // ëˆˆë¹”
    '195072', // ì§€ì˜¥ ëŒì§„
    '185245', // ê³ ë¬¸
    '188501', // ì•…ë ¹ ì‹œì•¼
    '196718', // ì–´ë‘ ì˜ ê¶ŒëŠ¥
    '198589', // íë¦¿í•´ì§€ê¸°
    '183752', // ë¶„ì—´
    '185123', // íˆ¬ì²™ ê¸€ë ˆì´ë¸Œ
  ],
  'DEATHKNIGHT': [
    '49998', // ì£½ìŒì˜ ì¼ê²©
    '195182', // ë£¬ ë¬´ê¸° ì¼ê²©
    '47528', // ì •ì‹  ì–¼ë¦¬ê¸°
    '43265', // ì£½ìŒê³¼ ë¶€íŒ¨
    '48707', // ëŒ€ë§ˆë²• ë³´í˜¸ë§‰
    '48792', // ì–¼ìŒê°™ì€ ì¸ë‚´ë ¥
    '49576', // ì£½ìŒì˜ ì†ì•„ê·€
    '56222', // ì–´ë‘ ì˜ ëª…ë ¹
    '61999', // ì•„êµ° ë˜ì‚´ë¦¬ê¸°
    '3714', // ì£½ìŒì˜ ê¸¸
  ],
  'EVOKER': [
    '361469', // ì‚´ì•„ìˆëŠ” ë¶ˆê½ƒ
    '357208', // ë¶ˆì˜ ìˆ¨ê²°
    '362969', // í‘¸ë¥¸ ìš©ì˜ í˜
    '351338', // ì–µì œ
    '358267', // í˜¸ë²„
    '357210', // ê¹Šì€ ìˆ¨ê²°
    '360806', // ì ìëŠ” ìˆ¨ê²°
    '363916', // í‘ìš”ì„ ë¹„ëŠ˜
    '365585', // ë‚ ê°œì˜ ì™„ì¶©
    '361227', // ê·€í™˜
  ]
};

// í´ë˜ìŠ¤ë³„ ëŒ€í‘œ íŠ¹ì„± ìŠ¤í‚¬ (íŠ¹ì„± íŠ¸ë¦¬ì—ë§Œ ìˆëŠ” ìŠ¤í‚¬ë“¤)
const talentSkills = {
  'WARRIOR': [
    '167105', // ê±°ì¸ì˜ ê°•íƒ€
    '262161', // ì „ìŸì¸ë„ì
    '152277', // ë¶„ì‡„
    '227847', // ì¹¼ë‚ í­í’
    '46968', // ì¶©ê²©íŒŒ
    '107574', // íˆ¬ì‹ 
    '260708', // íœ©ì“¸ê¸° ì¼ê²©
    '262150', // í•™ì‚´
    '383762', // í­ë°œì˜ ê²©ë…¸
    '392778', // ê´‘í­í•œ í¬íš¨
  ],
  'PALADIN': [
    '31850', // í—Œì‹ ì ì¸ ìˆ˜í˜¸ì
    '86659', // ê³ ëŒ€ ì™•ì˜ ìˆ˜í˜¸ì
    '231895', // ì„±ì „ì‚¬
    '215652', // ì •ì˜ì˜ ë°©íŒ¨
    '343527', // ì²˜í˜• ì„ ê³ 
    '255937', // ì‹­ìêµ°ì˜ ì„ ê³ 
    '343721', // ìµœí›„ì˜ ì‹¬íŒ
    '384027', // ì€ì´ì˜ ì¬
    '403876', // ë¹›ì˜ ì¸ë„
    '427441', // ì‹ ì„±í•œ ë³‘ê¸°
  ],
  'HUNTER': [
    '257044', // ê¸‰ì† ì‚¬ê²©
    '193530', // ì•¼ìƒì˜ ìƒ
    '260402', // ì´ì¤‘ ì‚¬ê²©
    '257620', // ë‹¤ì¤‘ ì‚¬ê²©
    '259387', // ëª½êµ¬ìŠ¤ ë¬¼ê¸°
    '266779', // ì¡°ì • ì‚¬ê²©
    '194407', // ì°½ íˆ¬ì²™
    '236776', // ìƒëª…ë ¥ í­ë°œ
    '390163', // ì•½ì  ê³µê²©
    '459922', // ì•¼ìˆ˜ì˜ ê²©ë…¸
  ],
  'ROGUE': [
    '196819', // ì ˆê°œ
    '185311', // ì§„í™ìƒ‰ í­í’ìš°
    '121471', // ê·¸ë¦¼ì ì¹¼ë‚ 
    '385616', // ë©”ì•„ë¦¬ì¹˜ëŠ” íŒŒë©¸
    '360194', // ë§í†  ì•”ì‚´
    '381623', // ì¸ë‚´ì˜ ì¦‰ë°œíƒ„
    '382245', // ëƒ‰í˜ˆ
    '384631', // ë¼ˆì£¼ì‚¬ìœ„
    '385408', // í˜ˆí­í’
    '426591', // ì ì¬ëœ ë…
  ],
  // ... ë‹¤ë¥¸ í´ë˜ìŠ¤ë“¤ë„ ì¶”ê°€
};

// ì „ë¬¸í™”ë³„ ìŠ¤í‚¬ ë§¤í•‘ ê°œì„ 
const specSkillMapping = {
  'ì „ì‚¬': {
    'ë¬´ê¸°': ['163201', '167105', '262161', '227847', '152277'],
    'ë¶„ë…¸': ['5308', '118038', '184367', '85288', '280735'],
    'ë°©ì–´': ['23922', '6572', '46968', '107574', '385952']
  },
  'ì„±ê¸°ì‚¬': {
    'ì‹ ì„±': ['19750', '183998', '53563', '183997', '114165'],
    'ë³´í˜¸': ['31935', '86659', '387174', '378974', '389539'],
    'ì§•ë²Œ': ['184575', '24275', '343527', '403876', '343721']
  },
  'ì‚¬ëƒ¥ê¾¼': {
    'ì•¼ìˆ˜': ['19574', '193530', '217200', '120679', '201430'],
    'ì‚¬ê²©': ['257044', '260402', '257620', '288613', '389880'],
    'ìƒì¡´': ['259387', '266779', '190925', '270335', '375891']
  },
  // ... ë‹¤ë¥¸ í´ë˜ìŠ¤ ì „ë¬¸í™”ë„ ì¶”ê°€
};

// ë°ì´í„°ë² ì´ìŠ¤ ê°œì„ 
let improvedCount = 0;
let baselineCount = 0;
let talentCount = 0;
let specAssignedCount = 0;

Object.entries(database).forEach(([className, classSkills]) => {
  // ê¸°ë³¸ ìŠ¤í‚¬ íŒë³„
  const baselineIds = baselineSkills[className] || [];
  const talentIds = talentSkills[className] || [];

  Object.entries(classSkills).forEach(([skillId, skill]) => {
    let improved = false;

    // 1. ê¸°ë³¸/íŠ¹ì„± íƒ€ì… ìˆ˜ì •
    if (baselineIds.includes(skillId)) {
      skill.type = 'ê¸°ë³¸';
      baselineCount++;
      improved = true;
    } else if (talentIds.includes(skillId)) {
      skill.type = 'íŠ¹ì„±';
      talentCount++;
      improved = true;
    }

    // 2. ì „ë¬¸í™” í• ë‹¹ ê°œì„ 
    const koreanClassName = skill.class;
    const specMapping = specSkillMapping[koreanClassName];

    if (specMapping) {
      for (const [specName, specSkillIds] of Object.entries(specMapping)) {
        if (specSkillIds.includes(skillId)) {
          skill.spec = specName;
          specAssignedCount++;
          improved = true;
          break;
        }
      }
    }

    // 3. ì„¤ëª…ì´ ë¹„ì–´ìˆê±°ë‚˜ ì˜ëª»ëœ ê²½ìš° ê¸°ë³¸ê°’ ì œê³µ
    if (!skill.description || skill.description.length < 5 || skill.description.includes('ì£¼ì˜:')) {
      skill.description = `${skill.koreanName || 'ì•Œ ìˆ˜ ì—†ëŠ” ìŠ¤í‚¬'}ì˜ ì„¤ëª…ì…ë‹ˆë‹¤. (ë°ì´í„° ìˆ˜ì§‘ ì¤‘)`;
      improved = true;
    }

    if (improved) improvedCount++;
  });
});

console.log(`âœ… ${improvedCount}ê°œ ìŠ¤í‚¬ ê°œì„  ì™„ë£Œ`);
console.log(`  - ê¸°ë³¸ ìŠ¤í‚¬: ${baselineCount}ê°œ`);
console.log(`  - íŠ¹ì„±: ${talentCount}ê°œ`);
console.log(`  - ì „ë¬¸í™” í• ë‹¹: ${specAssignedCount}ê°œ`);

// ê°œì„ ëœ ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥
const outputPath = path.join(__dirname, 'tww-s3-improved-database.json');
fs.writeFileSync(outputPath, JSON.stringify(database, null, 2), 'utf8');

// React ëª¨ë“ˆ ìƒì„±
console.log('\nğŸ“¦ React ëª¨ë“ˆ ìƒì„± ì¤‘...');

const allSkills = [];
const stats = {
  total: 0,
  baseline: 0,
  talents: 0,
  withSpec: 0
};

Object.entries(database).forEach(([className, classSkills]) => {
  Object.entries(classSkills).forEach(([skillId, skill]) => {
    allSkills.push(skill);
    stats.total++;
    if (skill.type === 'ê¸°ë³¸') stats.baseline++;
    if (skill.type === 'íŠ¹ì„±') stats.talents++;
    if (skill.spec && skill.spec !== 'ê³µìš©') stats.withSpec++;
  });
});

const moduleContent = `// TWW Season 3 ê°œì„ ëœ ìŠ¤í‚¬ ë°ì´í„°ë² ì´ìŠ¤
// ìƒì„±: ${new Date().toISOString()}
// ì´ ${stats.total}ê°œ ìŠ¤í‚¬ (ê¸°ë³¸: ${stats.baseline}, íŠ¹ì„±: ${stats.talents})

export const twwS3SkillDatabase = ${JSON.stringify(allSkills, null, 2)};

export const classData = {
  'ì „ì‚¬': { name: 'ì „ì‚¬', color: '#C79C6E', specs: ['ë¬´ê¸°', 'ë¶„ë…¸', 'ë°©ì–´'] },
  'ì„±ê¸°ì‚¬': { name: 'ì„±ê¸°ì‚¬', color: '#F58CBA', specs: ['ì‹ ì„±', 'ë³´í˜¸', 'ì§•ë²Œ'] },
  'ì‚¬ëƒ¥ê¾¼': { name: 'ì‚¬ëƒ¥ê¾¼', color: '#ABD473', specs: ['ì•¼ìˆ˜', 'ì‚¬ê²©', 'ìƒì¡´'] },
  'ë„ì ': { name: 'ë„ì ', color: '#FFF569', specs: ['ì•”ì‚´', 'ë¬´ë²•', 'ì í–‰'] },
  'ì‚¬ì œ': { name: 'ì‚¬ì œ', color: '#FFFFFF', specs: ['ìˆ˜ì–‘', 'ì‹ ì„±', 'ì•”í‘'] },
  'ì£¼ìˆ ì‚¬': { name: 'ì£¼ìˆ ì‚¬', color: '#0070DE', specs: ['ì •ê¸°', 'ê³ ì–‘', 'ë³µì›'] },
  'ë§ˆë²•ì‚¬': { name: 'ë§ˆë²•ì‚¬', color: '#69CCF0', specs: ['ë¹„ì „', 'í™”ì—¼', 'ëƒ‰ê¸°'] },
  'í‘ë§ˆë²•ì‚¬': { name: 'í‘ë§ˆë²•ì‚¬', color: '#9482C9', specs: ['ê³ í†µ', 'ì•…ë§ˆ', 'íŒŒê´´'] },
  'ìˆ˜ë„ì‚¬': { name: 'ìˆ˜ë„ì‚¬', color: '#00FF96', specs: ['ì–‘ì¡°', 'ìš´ë¬´', 'í’ìš´'] },
  'ë“œë£¨ì´ë“œ': { name: 'ë“œë£¨ì´ë“œ', color: '#FF7D0A', specs: ['ì¡°í™”', 'ì•¼ì„±', 'ìˆ˜í˜¸', 'íšŒë³µ'] },
  'ì•…ë§ˆì‚¬ëƒ¥ê¾¼': { name: 'ì•…ë§ˆì‚¬ëƒ¥ê¾¼', color: '#A330C9', specs: ['íŒŒë©¸', 'ë³µìˆ˜'] },
  'ì£½ìŒì˜ê¸°ì‚¬': { name: 'ì£½ìŒì˜ê¸°ì‚¬', color: '#C41E3A', specs: ['í˜ˆê¸°', 'ëƒ‰ê¸°', 'ë¶€ì •'] },
  'ê¸°ì›ì‚¬': { name: 'ê¸°ì›ì‚¬', color: '#33937F', specs: ['í™©í', 'ë³´ì¡´', 'ì¦ê°•'] }
};

export const databaseStats = {
  totalSkills: ${stats.total},
  basicSkills: ${stats.baseline},
  talentSkills: ${stats.talents},
  skillsWithSpec: ${stats.withSpec},
  classes: 13,
  patch: '11.2',
  season: 'TWW S3',
  lastUpdated: '${new Date().toISOString()}',
  dataQuality: {
    improved: true,
    typesClassified: true,
    specsEnhanced: true
  }
};

export default twwS3SkillDatabase;
`;

const reactModulePath = path.join(__dirname, '..', 'src', 'data', 'twwS3ImprovedSkillDatabase.js');
fs.writeFileSync(reactModulePath, moduleContent, 'utf8');

console.log(`\nâœ… ì‘ì—… ì™„ë£Œ!`);
console.log(`  ğŸ“ ê°œì„ ëœ DB: ${outputPath}`);
console.log(`  ğŸ“¦ React ëª¨ë“ˆ: ${reactModulePath}`);